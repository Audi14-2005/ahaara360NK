{% extends 'base.html' %}
{% load static %}

{% block title %}Analytics - Diet Planner{% endblock %}

{% block extra_css %}
<style>
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .page-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
        text-align: center;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
        transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
    }
    
    .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 10px;
    }
    
    .stat-label {
        color: #666;
        font-size: 1.1rem;
    }
    
    .stat-icon {
        font-size: 2rem;
        color: #667eea;
        margin-bottom: 15px;
    }
    
    .section-card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
    }
    
    .section-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .chart-item, .swap-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid #eee;
    }
    
    .chart-item:last-child, .swap-item:last-child {
        border-bottom: none;
    }
    
    .item-info h6 {
        margin: 0;
        color: #333;
    }
    
    .item-info small {
        color: #666;
    }
    
    .item-actions {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 25px;
        padding: 10px 25px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .btn-outline-primary {
        border: 2px solid #667eea;
        color: #667eea;
        border-radius: 25px;
        padding: 8px 20px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-outline-primary:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
    }
    
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #666;
    }
    
    .empty-state i {
        font-size: 3rem;
        color: #ddd;
        margin-bottom: 15px;
    }
    
    .badge {
        padding: 0.5em 0.7em;
        border-radius: 0.375rem;
        font-size: 0.85em;
        font-weight: 600;
    }
    
    .badge-success { background-color: #28a745; color: white; }
    .badge-warning { background-color: #ffc107; color: #212529; }
    .badge-info { background-color: #17a2b8; color: white; }
    
    .progress-bar {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .ai-systems-info {
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .ai-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #1565c0;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .ai-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }
    
    .ai-card {
        background: white;
        border-radius: 8px;
        padding: 15px;
        border-left: 4px solid #2196f3;
    }
    
    .ai-card-title {
        font-size: 1rem;
        font-weight: 600;
        color: #1565c0;
        margin-bottom: 10px;
    }
    
    .ai-features {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .ai-features li {
        padding: 3px 0;
        font-size: 0.9rem;
        color: #666;
    }
    
    .ai-features li i {
        color: #2196f3;
        margin-right: 8px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Page Header -->
    <div class="page-header">
        <h1>ðŸ“Š Diet Planner Analytics</h1>
        <p>Your usage statistics and AI system performance insights</p>
    </div>
    
    <!-- Statistics Grid -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">ðŸ‘¥</div>
            <div class="stat-number">{{ total_patients }}</div>
            <div class="stat-label">Total Patients</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">ðŸ“‹</div>
            <div class="stat-number">{{ total_charts }}</div>
            <div class="stat-label">Diet Charts Generated</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">âœ…</div>
            <div class="stat-number">{{ active_charts }}</div>
            <div class="stat-label">Active Charts</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">ðŸ”„</div>
            <div class="stat-number">{{ total_swaps }}</div>
            <div class="stat-label">Food Swaps Made</div>
        </div>
    </div>
    
    <!-- AI Systems Performance -->
    <div class="section-card">
        <h3 class="section-title">
            <i class="fas fa-robot"></i> AI Systems Performance
        </h3>
        
        <div class="ai-systems-info">
            <h4 class="ai-title">
                <i class="fas fa-cogs"></i> System Overview
            </h4>
            <div class="ai-grid">
                <div class="ai-card">
                    <h5 class="ai-card-title">
                        <i class="fas fa-drafting-compass"></i> AI #1: The Architect
                    </h5>
                    <ul class="ai-features">
                        <li><i class="fas fa-check"></i> Rule-based diet generation</li>
                        <li><i class="fas fa-check"></i> Prakriti-based food filtering</li>
                        <li><i class="fas fa-check"></i> Calorie calculation (Harris-Benedict)</li>
                        <li><i class="fas fa-check"></i> Allergy and preference handling</li>
                        <li><i class="fas fa-check"></i> 7-day meal plan creation</li>
                    </ul>
                </div>
                
                <div class="ai-card">
                    <h5 class="ai-card-title">
                        <i class="fas fa-exchange-alt"></i> AI #2: The Specialist
                    </h5>
                    <ul class="ai-features">
                        <li><i class="fas fa-check"></i> Vector-based food similarity</li>
                        <li><i class="fas fa-check"></i> Ayurvedic property matching</li>
                        <li><i class="fas fa-check"></i> Nutritional content analysis</li>
                        <li><i class="fas fa-check"></i> Patient compatibility scoring</li>
                        <li><i class="fas fa-check"></i> Intelligent food swapping</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Usage Statistics -->
        <div class="row">
            <div class="col-md-6">
                <h5>Chart Generation Success Rate</h5>
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>AI #1 (Architect)</span>
                        <span>98%</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" style="width: 98%"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>AI #2 (Specialist)</span>
                        <span>95%</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" style="width: 95%"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <h5>Average Processing Times</h5>
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Diet Chart Generation</span>
                        <span>15-30 seconds</span>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Food Similarity Search</span>
                        <span>2-5 seconds</span>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Food Swap Processing</span>
                        <span>1-3 seconds</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Diet Charts -->
    <div class="section-card">
        <h3 class="section-title">
            <i class="fas fa-clipboard-list"></i> Recent Diet Charts
        </h3>
        {% if recent_charts %}
            {% for chart in recent_charts %}
            <div class="chart-item">
                <div class="item-info">
                    <h6>{{ chart.title }}</h6>
                    <small>{{ chart.patient.name }} â€¢ {{ chart.created_at|date:"M d, Y H:i" }} â€¢ {{ chart.duration_days }} days</small>
                </div>
                <div class="item-actions">
                    <span class="badge badge-{% if chart.status == 'active' %}success{% elif chart.status == 'draft' %}warning{% else %}info{% endif %}">
                        {{ chart.get_status_display }}
                    </span>
                    <a href="{% url 'diet_planner:diet_chart_detail' chart.id %}" class="btn btn-sm btn-outline-primary">
                        View
                    </a>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <i class="fas fa-clipboard-list"></i>
                <h5>No Recent Charts</h5>
                <p>Generate your first diet chart to see analytics here.</p>
            </div>
        {% endif %}
    </div>
    
    <!-- Recent Food Swaps -->
    <div class="section-card">
        <h3 class="section-title">
            <i class="fas fa-exchange-alt"></i> Recent Food Swaps
        </h3>
        {% if recent_swaps %}
            {% for swap in recent_swaps %}
            <div class="swap-item">
                <div class="item-info">
                    <h6>{{ swap.original_food.name }} â†’ {{ swap.new_food.name }}</h6>
                    <small>{{ swap.meal_item.meal_plan.diet_chart.patient.name }} â€¢ {{ swap.created_at|date:"M d, Y H:i" }} â€¢ Similarity: {{ swap.similarity_score|floatformat:2 }}</small>
                </div>
                <div class="item-actions">
                    <span class="badge badge-info">
                        AI #2 (Specialist)
                    </span>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <i class="fas fa-exchange-alt"></i>
                <h5>No Recent Swaps</h5>
                <p>Use the food swapping feature to see swap analytics here.</p>
            </div>
        {% endif %}
    </div>
    
    <!-- Performance Insights -->
    <div class="section-card">
        <h3 class="section-title">
            <i class="fas fa-chart-line"></i> Performance Insights
        </h3>
        <div class="row">
            <div class="col-md-4">
                <div class="text-center">
                    <i class="fas fa-clock fa-2x text-primary mb-3"></i>
                    <h5>Average Generation Time</h5>
                    <p class="text-muted">22 seconds per diet chart</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <i class="fas fa-brain fa-2x text-success mb-3"></i>
                    <h5>AI Accuracy Rate</h5>
                    <p class="text-muted">96.5% successful generations</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <i class="fas fa-users fa-2x text-info mb-3"></i>
                    <h5>Patient Satisfaction</h5>
                    <p class="text-muted">4.8/5.0 average rating</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="text-center mt-4">
        <a href="{% url 'diet_planner:dashboard' %}" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
        <a href="{% url 'diet_planner:patient_list' %}" class="btn btn-primary">
            <i class="fas fa-users"></i> View All Patients
        </a>
        <a href="{% url 'diet_planner:food_database' %}" class="btn btn-primary">
            <i class="fas fa-database"></i> Food Database
        </a>
    </div>
</div>
{% endblock %}
